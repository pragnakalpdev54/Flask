
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pragnakalpdev54.github.io/Flask/05_LEVEL_2B_INTERMEDIATE.html">
      
      
        <link rel="prev" href="04_LEVEL_2A_INTERMEDIATE.html">
      
      
        <link rel="next" href="06_LEVEL_3_AUTHENTICATION.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Level 2B – Applied Flask - Flask Training Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/footer.css">
    
      <link rel="stylesheet" href="assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="assets/stylesheets/sidebar.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#level-2b-intermediate-serialization-error-handling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Flask Training Guide" class="md-header__button md-logo" aria-label="Flask Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flask Training Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Level 2B – Applied Flask
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Flask Training Guide" class="md-nav__button md-logo" aria-label="Flask Training Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Flask Training Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01_LEVEL_0_BEGINNER.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 0 – Beginner
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02_LEVEL_1_FOUNDATIONS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 – Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03_TEST_TASK_1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Task 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04_LEVEL_2A_INTERMEDIATE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 2A – Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Level 2B – Applied Flask
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="05_LEVEL_2B_INTERMEDIATE.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 2B – Applied Flask
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-marshmallow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Marshmallow?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining Schemas
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-input" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation (Input)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serialization-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serialization (Output)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Global Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-a-custom-exception" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Create a Custom Exception
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update-service-to-raise-it" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Update Service to raise it
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-catch-it-globally-in-apppy" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Catch it Globally in app.py
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice-problems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practice Problems
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice Problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-book-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem 1: Book Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-serialize-user-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem 2: Serialize User List
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-3-validate-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem 3: Validate Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-4-404-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem 4: 404 Handler
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-quiz" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Pitfalls Quiz
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls Quiz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pitfall-1-exposing-sensitive-fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pitfall 1: Exposing Sensitive Fields
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfall-2-confusing-load-vs-dump" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pitfall 2: Confusing load() vs dump()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfall-3-not-catching-validationerror" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pitfall 3: Not Catching ValidationError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfall-4-exposing-internal-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pitfall 4: Exposing Internal Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfall-5-wrong-schema-for-different-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pitfall 5: Wrong Schema for Different Operations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trivia" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trivia
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trivia">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Question 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Question 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Question 3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06_LEVEL_3_AUTHENTICATION.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 3 – Authentication & Security
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07_TEST_TASK_2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Task 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08_LEVEL_4_SCALABLE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 4 – Scalable Systems
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10_TEST_TASK_3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Task 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ERROR_TRACKING.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="PATTERN_CHEATSHEET.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Reference Guide
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTMAN_GUIDE_PART1_BASICS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Postman Basics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="POSTMAN_GUIDE_PART2_ADVANCED.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Postman Advanced
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="CURL_GUIDE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cURL Guide
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="level-2b-intermediate-serialization-error-handling">Level 2B: Intermediate - Serialization &amp; Error Handling<a class="headerlink" href="#level-2b-intermediate-serialization-error-handling" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Prerequisites</strong>: <a href="04_LEVEL_2A_INTERMEDIATE.html">Level 2A: Databases</a>
<strong>Next Level</strong>: <a href="06_LEVEL_3_AUTHENTICATION.html">Level 3: Authentication</a></p>
<p>[!NOTE]
<strong>OOP Level</strong>: Low. Schemas are classes, but they are just <strong>templates for data shapes</strong>. You declare fields, and Marshmallow does the magic. You do not need to understand advanced OOP concepts to use them.</p>
</blockquote>
<h2 id="goal">Goal<a class="headerlink" href="#goal" title="Permanent link">&para;</a></h2>
<p>In this level, we make our API robust. We will use <strong>Marshmallow</strong> for validation (incoming data) and serialization (outgoing data). We will also strictly implement <strong>Global Error Handling</strong> so users never see standard internal server errors.</p>
<p><strong>Strict Rules:</strong></p>
<ol>
<li><strong>Never return Model objects directly</strong>: Always serialize them to JSON.</li>
<li><strong>Never expose Stack Traces</strong>: Catch all errors and return generic JSON messages.</li>
<li><strong>Validate Inputs</strong>: Trust no one.</li>
</ol>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#why-marshmallow">Why Marshmallow?</a></li>
<li><a href="#defining-schemas">Defining Schemas</a></li>
<li><a href="#validation-input">Validation (Input)</a></li>
<li><a href="#serialization-output">Serialization (Output)</a></li>
<li><a href="#global-error-handling">Global Error Handling</a></li>
<li><a href="#practice-problems">Practice Problems</a></li>
</ol>
<h2 id="why-marshmallow">Why Marshmallow?<a class="headerlink" href="#why-marshmallow" title="Permanent link">&para;</a></h2>
<p>SQLAlchemy Models are Python Objects. APIs need JSON. Marshmallow bridges this gap.</p>
<ul>
<li><strong>Serialization</strong>: Object -&gt; JSON</li>
<li><strong>Deserialization</strong>: JSON -&gt; Object (with Validation!)</li>
</ul>
<p>Install it:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>flask-marshmallow<span class="w"> </span>marshmallow-sqlalchemy
</code></pre></div>

<h2 id="defining-schemas">Defining Schemas<a class="headerlink" href="#defining-schemas" title="Permanent link">&para;</a></h2>
<p>Schemas usually sit near your models or in a <code>schemas/</code> folder.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask_marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Marshmallow</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="n">ma</span> <span class="o">=</span> <span class="n">Marshmallow</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">SQLAlchemyAutoSchema</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">load_instance</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Optional: deserialize to model instances</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;password_hash&quot;</span><span class="p">,)</span>  <span class="c1"># Never expose password hashes</span>

<span class="c1"># Initialize schemas</span>
<span class="n">user_schema</span> <span class="o">=</span> <span class="n">UserSchema</span><span class="p">()</span>
<span class="n">users_schema</span> <span class="o">=</span> <span class="n">UserSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>[!TIP]
<strong>Magic Box – Schemas &amp; <code>ma</code></strong>: Treat <code>ma = Marshmallow()</code> and <code>class UserSchema(...)</code> as Magic Boxes that know how to turn your models into JSON and validate input. Focus on which fields you declare and what errors you return, not on how Marshmallow works internally.</p>
</blockquote>
<h2 id="validation-input">Validation (Input)<a class="headerlink" href="#validation-input" title="Permanent link">&para;</a></h2>
<p>Use the schema to validate incoming JSON before it reaches your Service Layer.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">():</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">user_schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">messages</span><span class="p">),</span> <span class="mi">400</span>

    <span class="c1"># Proceed to service...</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserService</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span>
        <span class="n">email</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">],</span>
        <span class="n">password_hash</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;password_hash&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div>

<h2 id="serialization-output">Serialization (Output)<a class="headerlink" href="#serialization-output" title="Permanent link">&para;</a></h2>
<p>Never manually build dictionaries like <code>{'id': user.id, ...}</code>. Use the schema.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">UserService</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">()</span>

    <span class="c1"># Dump list of users</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">users_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserService</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="c1"># Dump single user</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">user_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
</code></pre></div>

<h2 id="global-error-handling">Global Error Handling<a class="headerlink" href="#global-error-handling" title="Permanent link">&para;</a></h2>
<p><strong>Rule</strong>: User should not be able to see the internal server errors on UI.</p>
<p>Instead of <code>try-except</code> in every route, use <code>errorhandler</code>.</p>
<h3 id="1-create-a-custom-exception">1. Create a Custom Exception<a class="headerlink" href="#1-create-a-custom-exception" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># errors.py</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AppError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>
</code></pre></div>

<h3 id="2-update-service-to-raise-it">2. Update Service to raise it<a class="headerlink" href="#2-update-service-to-raise-it" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># services/user_service.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">AppError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AppError</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div>

<h3 id="3-catch-it-globally-in-apppy">3. Catch it Globally in <code>app.py</code><a class="headerlink" href="#3-catch-it-globally-in-apppy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">AppError</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="c1"># ... config ...</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">AppError</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_app_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
            <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span>
        <span class="p">}),</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_500</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="c1"># Log the real error to a file/logging service</span>
        <span class="c1"># app.logger.error(e)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Internal Server Error&quot;</span><span class="p">}),</span> <span class="mi">500</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_404</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Resource not found&quot;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="k">return</span> <span class="n">app</span>
</code></pre></div>

<p><strong>Result</strong>: Even if your code crashes, the user sees <code>{"error": "Internal Server Error"}</code> (JSON), not a scary HTML stack trace.</p>
<h2 id="practice-problems">Practice Problems<a class="headerlink" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-book-schema">Problem 1: Book Schema<a class="headerlink" href="#problem-1-book-schema" title="Permanent link">&para;</a></h3>
<p>Create a <code>BookSchema</code> for your Book model. Configure it to auto-generate from the SQLAlchemy model.</p>
<h3 id="problem-2-serialize-user-list">Problem 2: Serialize User List<a class="headerlink" href="#problem-2-serialize-user-list" title="Permanent link">&para;</a></h3>
<p>Create an endpoint <code>/api/users</code> that returns all users as JSON using Marshmallow.</p>
<p><strong>Starter code</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserSchema</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">user_schema</span> <span class="o">=</span> <span class="n">UserSchema</span><span class="p">()</span>
<span class="n">users_schema</span> <span class="o">=</span> <span class="n">UserSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1"># Serialize the users</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">users_schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>  <span class="c1"># Is this correct?</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
</code></pre></div>

<h3 id="problem-3-validate-implementation">Problem 3: Validate Implementation<a class="headerlink" href="#problem-3-validate-implementation" title="Permanent link">&para;</a></h3>
<p>Update your <code>create_book</code> route to use <code>book_schema.load()</code>. Try sending invalid data (missing title) and confirm you get a 400 JSON response with validation errors.</p>
<h3 id="problem-4-404-handler">Problem 4: 404 Handler<a class="headerlink" href="#problem-4-404-handler" title="Permanent link">&para;</a></h3>
<p>Implement a global 404 handler that returns <code>{"error": "This endpoint does not exist"}</code>. Use Postman to trigger it.</p>
<h2 id="common-pitfalls-quiz">Common Pitfalls Quiz<a class="headerlink" href="#common-pitfalls-quiz" title="Permanent link">&para;</a></h2>
<p>Test your understanding of serialization and validation:</p>
<h3 id="pitfall-1-exposing-sensitive-fields">Pitfall 1: Exposing Sensitive Fields<a class="headerlink" href="#pitfall-1-exposing-sensitive-fields" title="Permanent link">&para;</a></h3>
<p><strong>Question</strong>: What's wrong with this schema?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">SQLAlchemyAutoSchema</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">load_instance</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># No exclusions!</span>
</code></pre></div>

<details>
<summary>Click to see answer</summary>

**Answer**: This exposes **password_hash** in API responses! Anyone can see hashed passwords.

**Fix**:


<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">SQLAlchemyAutoSchema</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">load_instance</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;password_hash&quot;</span><span class="p">,)</span>  <span class="c1"># Never expose passwords!</span>
</code></pre></div>



**Critical security rule**: NEVER expose:

- `password_hash`
- `password`
- API keys
- Tokens
- Internal IDs you don't want users to know

</details>

<h3 id="pitfall-2-confusing-load-vs-dump">Pitfall 2: Confusing load() vs dump()<a class="headerlink" href="#pitfall-2-confusing-load-vs-dump" title="Permanent link">&para;</a></h3>
<p><strong>Question</strong>: Why does this crash?</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">user_schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>  <span class="c1"># Wrong method!</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
</code></pre></div>

<details>
<summary>Click to see answer</summary>

**Answer**: `load()` is for **input** (JSON → Object), `dump()` is for **output** (Object → JSON). You're trying to load when you should dump!

**Fix**:


<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">users_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>  <span class="c1"># dump = serialize for output</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
</code></pre></div>



**Remember**:

- `schema.load(json_data)` - Validate input, deserialize
- `schema.dump(model_object)` - Serialize for output

</details>

<h3 id="pitfall-3-not-catching-validationerror">Pitfall 3: Not Catching ValidationError<a class="headerlink" href="#pitfall-3-not-catching-validationerror" title="Permanent link">&para;</a></h3>
<p><strong>Question</strong>: What happens when a user sends invalid data?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">validated</span> <span class="o">=</span> <span class="n">user_schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># What if validation fails?</span>
    <span class="c1"># ... create user ...</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Created&quot;</span><span class="p">}),</span> <span class="mi">201</span>
</code></pre></div>

<details>
<summary>Click to see answer</summary>

**Answer**: If validation fails, Marshmallow raises `ValidationError`, which crashes your app with a 500 error instead of returning proper 400.

**Fix**:


<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">marshmallow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>

<span class="o">@</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="n">user_schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">messages</span><span class="p">),</span> <span class="mi">400</span>  <span class="c1"># Return validation errors</span>

    <span class="c1"># ... create user ...</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Created&quot;</span><span class="p">}),</span> <span class="mi">201</span>
</code></pre></div>



**Better with global handler**:


<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_validation_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">messages</span><span class="p">),</span> <span class="mi">400</span>
</code></pre></div>



</details>

<h3 id="pitfall-4-exposing-internal-errors">Pitfall 4: Exposing Internal Errors<a class="headerlink" href="#pitfall-4-exposing-internal-errors" title="Permanent link">&para;</a></h3>
<p><strong>Question</strong>: What's wrong with this error handler?</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_500</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">500</span>  <span class="c1"># Exposing internal details!</span>
</code></pre></div>

<details>
<summary>Click to see answer</summary>

**Answer**: **NEVER expose internal errors to users!** This leaks:

- Database schema details
- File paths
- Stack traces
- Library versions

Attackers use this information!

**Fix**:


<div class="codehilite"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_500</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="c1"># Log internally</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Return generic message to user</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Internal server error&quot;</span><span class="p">}),</span> <span class="mi">500</span>
</code></pre></div>



</details>

<h3 id="pitfall-5-wrong-schema-for-different-operations">Pitfall 5: Wrong Schema for Different Operations<a class="headerlink" href="#pitfall-5-wrong-schema-for-different-operations" title="Permanent link">&para;</a></h3>
<p><strong>Question</strong>: How do you handle different requirements for registration vs login?</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Registration needs: username, email, password</span>
<span class="c1"># Login needs: email, password (no username)</span>
<span class="c1"># Using same schema for both?</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<details>
<summary>Click to see answer</summary>

**Answer**: Use **different schemas** for different operations!

**Fix**:


<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserRegistrationSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserLoginSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># No username needed for login</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserResponseSchema</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">SQLAlchemyAutoSchema</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;password_hash&quot;</span><span class="p">,)</span>  <span class="c1"># Never return password</span>

<span class="c1"># Use appropriate schema</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">UserRegistrationSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">())</span>
    <span class="c1"># ...</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">UserLoginSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">())</span>
    <span class="c1"># ...</span>
</code></pre></div>



</details>

<h2 id="trivia">Trivia<a class="headerlink" href="#trivia" title="Permanent link">&para;</a></h2>
<h3 id="question-1">Question 1<a class="headerlink" href="#question-1" title="Permanent link">&para;</a></h3>
<p><strong>What is the method to convert an Object to JSON using Marshmallow?</strong></p>
<ul>
<li>[ ] <code>schema.load()</code></li>
<li>[x] <code>schema.dump()</code></li>
<li>[ ] <code>schema.json()</code></li>
<li>[ ] <code>schema.serialize()</code></li>
</ul>
<h3 id="question-2">Question 2<a class="headerlink" href="#question-2" title="Permanent link">&para;</a></h3>
<p><strong>What allows us to catch exceptions globally?</strong></p>
<ul>
<li>[ ] <code>@app.route</code></li>
<li>[ ] <code>@app.exception</code></li>
<li>[x] <code>@app.errorhandler</code></li>
<li>[ ] <code>try...except</code> block in <code>main</code></li>
</ul>
<h3 id="question-3">Question 3<a class="headerlink" href="#question-3" title="Permanent link">&para;</a></h3>
<p><strong>If a validation error occurs during <code>schema.load()</code>, what exception is raised?</strong></p>
<ul>
<li>[ ] <code>ValueError</code></li>
<li>[x] <code>ValidationError</code></li>
<li>[ ] <code>TypeError</code></li>
<li>[ ] <code>JsonError</code></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        


<nav class="md-footer__nav md-grid pill-navigation" aria-label="Footer navigation">
  
  
  <a href="04_LEVEL_2A_INTERMEDIATE.html"
     class="pill-btn pill-prev"
     aria-label="Previous page">
    <span class="pill-arrow">‹</span>
    <span class="pill-text">PREVIOUS</span>
  </a>
  

  
  <a href="06_LEVEL_3_AUTHENTICATION.html"
     class="pill-btn pill-next"
     aria-label="Next page">
    <span class="pill-text">NEXT</span>
    <span class="pill-arrow">›</span>
  </a>
  

</nav>




<footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner footer-custom">

      <!-- Left -->
      <div class="footer-col footer-left">
        <strong>Flask Training Guide</strong>
      </div>

      <!-- Center -->
      <div class="footer-col footer-center">
        <p>© 2026 Pragnakalp Techlabs</p>
      </div>

      <!-- Right -->
      <div class="footer-col footer-right">
        <p class="footer-heading">Contributors</p>
        <div class="contributors">
          <span class="contributor">Rahul</span>
          <span class="contributor">Nikunj</span>
          <span class="contributor">Neel</span>
          <span class="contributor">Dhvanil</span>
          <span class="contributor">Mansi</span>
          <span class="contributor">Darshit</span>
        </div>
      </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.expand", "navigation.instant", "toc.integrate", "content.code.copy", "navigation.footer"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>